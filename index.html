<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Practice scales and improve your musical ear with Western, Hindustani, and Carnatic ragas">
    <meta name="theme-color" content="#E6D9F6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Ear Train">

    <title>Ear Training Practice</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- Icons for iOS -->
    <link rel="apple-touch-icon" href="icon-192.png">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@300;400;600&family=Patrick+Hand&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="styles.css?v=1767129596">
</head>
<body>
    <div class="container">
        <header>
            <h1>Ear Training</h1>
            <p class="subtitle">Practice so that we may sing praise to Your name!</p>
        </header>

        <main>
            <!-- Pattern Generation Settings -->
            <section class="section">
                <h2>Pattern Settings</h2>

                <div class="setting-row">
                    <label for="pattern-mode">Pattern Source:</label>
                    <select id="pattern-mode">
                        <option value="pedagogical" selected>Pedagogical (Traditional)</option>
                        <option value="random">Random (Rule-based)</option>
                        <option value="custom">Custom (Enter Your Own)</option>
                    </select>
                </div>

                <!-- Custom pattern input (hidden by default) -->
                <div id="custom-pattern-container" class="custom-pattern-container" style="display: none;">
                    <label>Enter pattern (one number per box):</label>
                    <div id="custom-pattern-boxes" class="custom-pattern-boxes">
                        <!-- Boxes will be created dynamically -->
                    </div>
                    <div class="custom-pattern-actions">
                        <button id="use-custom-pattern-btn" class="btn btn-small">Use This Pattern</button>
                        <button id="clear-custom-pattern-btn" class="btn btn-small">Clear</button>
                    </div>
                    <span id="custom-pattern-error" class="error-text"></span>
                </div>

                <div class="setting-row">
                    <label for="scale">Scale:</label>
                    <select id="scale">
                        <optgroup label="Western Scales">
                            <option value="major" selected>Major (Ionian)</option>
                            <option value="natural-minor">Natural Minor (Aeolian)</option>
                            <option value="harmonic-minor">Harmonic Minor</option>
                            <option value="melodic-minor">Melodic Minor</option>
                            <option value="pentatonic-major">Pentatonic Major</option>
                            <option value="pentatonic-minor">Pentatonic Minor</option>
                        </optgroup>
                        <optgroup label="Hindustani Ragas">
                            <option value="bhairav">Bhairav (Morning)</option>
                            <option value="yaman">Yaman (Evening)</option>
                            <option value="kafi">Kafi (Afternoon)</option>
                            <option value="bilaval">Bilaval (Morning)</option>
                            <option value="bhairavi">Bhairavi (Night)</option>
                            <option value="todi">Todi (Afternoon)</option>
                        </optgroup>
                        <optgroup label="Carnatic Ragas">
                            <option value="mayamalavagowla">Mayamalavagowla (15)</option>
                            <option value="shankarabharanam">Shankarabharanam (29)</option>
                            <option value="kalyani">Kalyani (65)</option>
                            <option value="kharaharapriya">Kharaharapriya (22)</option>
                            <option value="harikambhoji">Harikambhoji (28)</option>
                            <option value="natabhairavi">Natabhairavi (20)</option>
                        </optgroup>
                    </select>
                </div>

                <div class="setting-row">
                    <label for="difficulty">Difficulty:</label>
                    <select id="difficulty">
                        <option value="easy">Easy (stepwise)</option>
                        <option value="medium" selected>Medium (small skips)</option>
                        <option value="hard">Hard (large intervals)</option>
                    </select>
                </div>

                <button id="generate-btn" class="btn btn-primary">Generate New Pattern</button>
            </section>

            <!-- Audio Settings -->
            <section class="section">
                <h2>Audio Settings</h2>

                <div class="setting-row">
                    <label for="instrument">Instrument Sound:</label>
                    <select id="instrument">
                        <option value="harmonium" selected>Harmonium (Indian reed organ)</option>
                        <option value="tanpura">Tanpura (Resonant drone)</option>
                        <option value="piano">Piano (Western classic)</option>
                        <option value="bansuri">Bansuri (Bamboo flute)</option>
                        <option value="sarangi">Sarangi (Bowed string)</option>
                        <option value="veena">Veena/Sitar (Plucked string)</option>
                        <option value="bell">Bell (Clear & bright)</option>
                        <option value="sine">Pure Tone (Simple reference)</option>
                    </select>
                </div>
            </section>

            <!-- Notation Display Settings -->
            <section class="section">
                <h2>Display Options</h2>

                <div class="setting-row">
                    <label>Show during playback:</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="show-numbers" checked>
                            Numbers (1, 2, 3...)
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="show-syllables" checked>
                            Syllables (Do/Sa, Re, Mi/Ga...)
                        </label>
                    </div>
                </div>

                <div class="setting-row">
                    <label for="syllable-system">Syllable System:</label>
                    <select id="syllable-system">
                        <option value="western" selected>Western (Do Re Mi)</option>
                        <option value="hindustani">Hindustani (Sa Re Ga)</option>
                        <option value="carnatic">Carnatic (Sa Ri Ga)</option>
                    </select>
                </div>
            </section>

            <!-- Pattern Display -->
            <section class="section pattern-display-section">
                <h2>Current Pattern</h2>
                <div id="pattern-display" class="pattern-display">
                    <span class="pattern-text">Click "Generate New Pattern" to start</span>
                </div>
                <div id="scale-info" class="scale-info"></div>
            </section>

            <!-- Visual Scale Display -->
            <section class="section">
                <h2>Scale Position</h2>
                <div id="scale-visual" class="scale-visual">
                    <!-- Will be populated by JavaScript -->
                </div>
                <div id="current-note" class="current-note-display"></div>
                <div id="interval-display" class="interval-display"></div>
            </section>

            <!-- Pakad Phrases (Hindustani Ragas only) -->
            <section id="pakad-section" class="section" style="display: none;">
                <details>
                    <summary>Pakad Phrases</summary>
                    <p class="info-text">Characteristic phrases that define this raga:</p>
                    <div id="pakad-phrases" class="pakad-phrases">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </details>
            </section>

            <!-- Playback Controls -->
            <section class="section">
                <h2>Playback</h2>

                <!-- Practice Mode Toggle -->
                <div class="practice-mode-toggle">
                    <label>Practice Mode:</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="practice-mode" value="listen" checked>
                            Listen (auto-play)
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="practice-mode" value="self-paced">
                            Self-Paced (you control)
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="practice-mode" value="test">
                            Test Mode (coming soon)
                        </label>
                    </div>

                    <!-- Self-paced controls -->
                    <div id="self-paced-controls" class="self-paced-controls" style="display: none;">
                        <p style="margin-bottom: 12px; color: var(--text-subtle); font-size: 0.95em;">
                            Try to sing the highlighted note, then check if you got it right:
                        </p>
                        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <button id="check-note-btn" class="btn" disabled>Play Current Note</button>
                            <button id="next-note-btn" class="btn" disabled>Next Note â†’</button>
                            <button id="restart-self-paced-btn" class="btn" disabled>Start Over</button>
                        </div>
                    </div>
                </div>

                <!-- Main Playback Controls -->
                <div class="playback-controls">
                    <button id="play-btn" class="btn" disabled>Play</button>
                    <button id="pause-btn" class="btn" disabled>Pause</button>
                    <button id="restart-btn" class="btn" disabled>Restart</button>
                </div>
                <div id="loop-indicator" class="loop-indicator"></div>

                <!-- Advanced Playback Options -->
                <details class="advanced-controls">
                    <summary>Advanced Controls</summary>

                    <div class="setting-row">
                        <label for="note-duration">Note duration:</label>
                        <input type="range" id="note-duration" min="200" max="2000" step="100" value="1000">
                        <span id="note-duration-value">1.0s</span>
                    </div>

                    <div class="setting-row">
                        <label for="note-gap">Gap between notes:</label>
                        <input type="range" id="note-gap" min="0" max="2000" step="100" value="250">
                        <span id="note-gap-value">0.25s</span>
                    </div>

                    <div class="setting-row">
                        <label for="speed">Speed:</label>
                        <input type="range" id="speed" min="0.5" max="2" step="0.1" value="1">
                        <span id="speed-value">1.0x</span>
                    </div>

                    <div class="setting-row">
                        <label for="loop-count">Loop pattern:</label>
                        <input type="number" id="loop-count" min="1" max="10" value="1">
                        <span>times</span>
                    </div>

                    <div class="setting-row">
                        <label class="checkbox-label">
                            <input type="checkbox" id="manual-mode">
                            Manual stepping (click to play each note)
                        </label>
                    </div>
                </details>
            </section>

            <!-- Pattern Bookmarks -->
            <section class="section">
                <h2>Pattern Bookmarks</h2>
                <button id="bookmark-pattern-btn" class="btn" disabled>
                    Bookmark This Pattern
                </button>
                <div id="bookmarks-list" class="bookmarks-list">
                    <p class="empty-state">No bookmarks yet. Generate a pattern and bookmark it!</p>
                </div>
            </section>

            <!-- Practice History -->
            <section class="section">
                <details>
                    <summary>Practice History</summary>
                    <div class="practice-stats">
                    <div class="stat-item">
                        <span class="stat-value" id="total-sessions">0</span>
                        <span class="stat-label">Total Sessions</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="current-streak">0</span>
                        <span class="stat-label">Day Streak</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="total-patterns">0</span>
                        <span class="stat-label">Patterns Played</span>
                    </div>
                </div>
                <div id="practice-calendar" class="practice-calendar">
                    <!-- Calendar will be generated by JavaScript -->
                </div>
                </details>
            </section>

            <!-- Coming Soon Sections -->
            <section class="section info-section">
                <details>
                    <summary>Coming Soon</summary>
                    <ul>
                        <li>Test Mode: Real-time pitch detection and feedback</li>
                        <li>Guessing Mode: Identify intervals by ear</li>
                        <li>Interval Names: Learn interval labels</li>
                    </ul>
                </details>
            </section>
        </main>
    </div>

    <script src="scales.js"></script>
    <script src="audio-engine.js"></script>
    <script src="app.js"></script>
</body>
</html>
