<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Practice scales and improve your musical ear with Western, Hindustani, and Carnatic ragas">
    <meta name="theme-color" content="#E6D9F6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Ear Train">

    <title>Ear Training Practice</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- Icons for iOS -->
    <link rel="apple-touch-icon" href="icon-192.png">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@300;400;600&family=Patrick+Hand&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="styles.css?v=1767151632">
</head>
<body>
    <!-- Mobile audio unlock prompt -->
    <div id="audio-unlock-banner" class="audio-unlock-banner" style="display: none;">
        <p>Turn off Silent Mode to hear sound</p>
    </div>

    <div class="container">
        <header>
            <h1>Ear Training</h1>
            <p class="subtitle">Practice so that we may sing praise to Your name!</p>
        </header>

        <!-- Mode Toggle -->
        <div class="mode-toggle">
            <button id="training-mode-btn" class="mode-btn active" data-mode="training">Training Mode</button>
            <button id="guessing-mode-btn" class="mode-btn" data-mode="guessing">Guessing Mode</button>
        </div>

        <!-- Audio status and help -->
        <div class="audio-controls-below-header">
            <!-- Audio status indicator (desktop only) -->
            <div id="audio-status-indicator" class="audio-status-indicator" title="Audio status">
                <svg width="16" height="16" viewBox="0 0 16 16" class="status-icon">
                    <circle cx="8" cy="8" r="5" class="status-circle"/>
                </svg>
            </div>

            <!-- Help icon -->
            <div id="audio-help-icon" class="audio-help-icon" title="Audio help">
                <svg width="20" height="20" viewBox="0 0 20 20" class="help-icon">
                    <path d="M 4 6 Q 4 2 10 2 Q 16 2 16 6 Q 16 8 14 9 L 12 11 L 12 13"
                          stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round"/>
                    <circle cx="12" cy="16" r="0.8" fill="currentColor"/>
                </svg>
            </div>

            <!-- Help tooltip (hidden by default) -->
            <div id="audio-help-tooltip" class="audio-help-tooltip" style="display: none;">
                <div class="help-close">×</div>
                <div class="help-title">Can't hear sound?</div>
                <div class="help-tips">
                    <div class="help-tip">Turn off Silent Mode</div>
                    <div class="help-tip-sub">(Check ringer switch on iPhone)</div>
                    <div class="help-tip">Turn up volume</div>
                    <div class="help-tip">Try using headphones</div>
                </div>
            </div>
        </div>

        <!-- Training Mode Container -->
        <main id="training-mode-container">
            <!-- Pattern Generation Settings -->
            <section class="section">
                <h2>Pattern Settings</h2>

                <div class="setting-row">
                    <label for="pattern-mode">Pattern Source:</label>
                    <select id="pattern-mode">
                        <option value="pedagogical" selected>Pedagogical (Traditional)</option>
                        <option value="random">Random (Rule-based)</option>
                        <option value="custom">Custom (Enter Your Own)</option>
                    </select>
                </div>

                <!-- Custom pattern input (hidden by default) -->
                <div id="custom-pattern-container" class="custom-pattern-container" style="display: none;">
                    <label>Enter pattern (one number per box):</label>
                    <div id="custom-pattern-boxes" class="custom-pattern-boxes">
                        <!-- Boxes will be created dynamically -->
                    </div>
                    <div class="custom-pattern-actions">
                        <button id="use-custom-pattern-btn" class="btn btn-small">Use This Pattern</button>
                        <button id="clear-custom-pattern-btn" class="btn btn-small">Clear</button>
                    </div>
                    <span id="custom-pattern-error" class="error-text"></span>
                </div>

                <div class="setting-row">
                    <label for="scale">Scale:</label>
                    <select id="scale">
                        <optgroup label="Western Scales">
                            <option value="major" selected>Major (Ionian)</option>
                            <option value="natural-minor">Natural Minor (Aeolian)</option>
                            <option value="harmonic-minor">Harmonic Minor</option>
                            <option value="melodic-minor">Melodic Minor</option>
                            <option value="pentatonic-major">Pentatonic Major</option>
                            <option value="pentatonic-minor">Pentatonic Minor</option>
                        </optgroup>
                        <optgroup label="Hindustani Ragas">
                            <option value="bhairav">Bhairav (Morning)</option>
                            <option value="yaman">Yaman (Evening)</option>
                            <option value="kafi">Kafi (Afternoon)</option>
                            <option value="bilaval">Bilaval (Morning)</option>
                            <option value="bhairavi">Bhairavi (Night)</option>
                            <option value="todi">Todi (Afternoon)</option>
                        </optgroup>
                        <optgroup label="Carnatic Ragas">
                            <option value="mayamalavagowla">Mayamalavagowla (15)</option>
                            <option value="shankarabharanam">Shankarabharanam (29)</option>
                            <option value="kalyani">Kalyani (65)</option>
                            <option value="kharaharapriya">Kharaharapriya (22)</option>
                            <option value="harikambhoji">Harikambhoji (28)</option>
                            <option value="natabhairavi">Natabhairavi (20)</option>
                        </optgroup>
                    </select>
                </div>

                <div class="setting-row">
                    <label for="difficulty">Difficulty:</label>
                    <select id="difficulty">
                        <option value="easy">Easy (stepwise)</option>
                        <option value="medium" selected>Medium (small skips)</option>
                        <option value="hard">Hard (large intervals)</option>
                    </select>
                </div>

                <button id="generate-btn" class="btn btn-primary">Generate New Pattern</button>
            </section>

            <!-- Audio Settings -->
            <section class="section">
                <h2>Audio Settings</h2>

                <div class="setting-row">
                    <label for="instrument">Instrument Sound:</label>
                    <select id="instrument">
                        <option value="piano" selected>Piano (Western classic)</option>
                        <option value="sine">Pure Tone (Simple reference)</option>
                        <option value="harmonium">Harmonium (Indian reed organ)</option>
                        <option value="tanpura">Tanpura (Resonant drone)</option>
                        <option value="bansuri">Bansuri (Bamboo flute)</option>
                        <option value="sarangi">Sarangi (Bowed string)</option>
                        <option value="veena">Veena/Sitar (Plucked string)</option>
                        <option value="bell">Bell (Clear & bright)</option>
                    </select>
                </div>
            </section>

            <!-- Notation Display Settings -->
            <section class="section">
                <h2>Display Options</h2>

                <div class="setting-row">
                    <label>Show during playback:</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="show-numbers" checked>
                            Numbers (1, 2, 3...)
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="show-syllables" checked>
                            Syllables (Do/Sa, Re, Mi/Ga...)
                        </label>
                    </div>
                </div>

                <div class="setting-row">
                    <label for="syllable-system">Syllable System:</label>
                    <select id="syllable-system">
                        <option value="western" selected>Western (Do Re Mi)</option>
                        <option value="hindustani">Hindustani (Sa Re Ga)</option>
                        <option value="carnatic">Carnatic (Sa Ri Ga)</option>
                    </select>
                </div>
            </section>

            <!-- Pattern Display -->
            <section class="section pattern-display-section">
                <h2>Current Pattern</h2>
                <div id="pattern-display" class="pattern-display">
                    <span class="pattern-text">Click "Generate New Pattern" to start</span>
                </div>
                <div id="scale-info" class="scale-info"></div>
            </section>

            <!-- Visual Scale Display -->
            <section class="section">
                <h2>Scale Position</h2>
                <div id="scale-visual" class="scale-visual">
                    <!-- Will be populated by JavaScript -->
                </div>
                <div id="current-note" class="current-note-display"></div>
                <div id="interval-display" class="interval-display"></div>
            </section>

            <!-- Pakad Phrases (Hindustani Ragas only) -->
            <section id="pakad-section" class="section" style="display: none;">
                <details>
                    <summary>Pakad Phrases</summary>
                    <p class="info-text">Characteristic phrases that define this raga:</p>
                    <div id="pakad-phrases" class="pakad-phrases">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </details>
            </section>

            <!-- Playback Controls -->
            <section class="section">
                <h2>Playback</h2>

                <!-- Practice Mode Toggle -->
                <div class="practice-mode-toggle">
                    <label>Practice Mode:</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="practice-mode" value="listen" checked>
                            Listen (auto-play)
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="practice-mode" value="self-paced">
                            Self-Paced (you control)
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="practice-mode" value="test">
                            Test Mode (coming soon)
                        </label>
                    </div>

                    <!-- Self-paced controls -->
                    <div id="self-paced-controls" class="self-paced-controls" style="display: none;">
                        <p style="margin-bottom: 12px; color: var(--text-subtle); font-size: 0.95em;">
                            Try to sing the highlighted note, then check if you got it right:
                        </p>
                        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <button id="check-note-btn" class="btn" disabled>Play Current Note</button>
                            <button id="next-note-btn" class="btn" disabled>Next Note →</button>
                            <button id="restart-self-paced-btn" class="btn" disabled>Start Over</button>
                        </div>
                    </div>
                </div>

                <!-- Main Playback Controls -->
                <div class="playback-controls">
                    <button id="play-btn" class="btn" disabled>Play</button>
                    <button id="pause-btn" class="btn" disabled>Pause</button>
                    <button id="restart-btn" class="btn" disabled>Restart</button>
                </div>
                <div id="loop-indicator" class="loop-indicator"></div>

                <!-- Advanced Playback Options -->
                <details class="advanced-controls">
                    <summary>Advanced Controls</summary>

                    <div class="setting-row">
                        <label for="note-duration">Note duration:</label>
                        <input type="range" id="note-duration" min="200" max="2000" step="100" value="1000">
                        <span id="note-duration-value">1.0s</span>
                    </div>

                    <div class="setting-row">
                        <label for="note-gap">Gap between notes:</label>
                        <input type="range" id="note-gap" min="0" max="2000" step="100" value="250">
                        <span id="note-gap-value">0.25s</span>
                    </div>

                    <div class="setting-row">
                        <label for="speed">Speed:</label>
                        <input type="range" id="speed" min="0.5" max="2" step="0.1" value="1">
                        <span id="speed-value">1.0x</span>
                    </div>

                    <div class="setting-row">
                        <label for="loop-count">Loop pattern:</label>
                        <input type="number" id="loop-count" min="1" max="10" value="1">
                        <span>times</span>
                    </div>

                    <div class="setting-row">
                        <label class="checkbox-label">
                            <input type="checkbox" id="manual-mode">
                            Manual stepping (click to play each note)
                        </label>
                    </div>
                </details>
            </section>

            <!-- Pattern Bookmarks -->
            <section class="section">
                <h2>Pattern Bookmarks</h2>
                <button id="bookmark-pattern-btn" class="btn" disabled>
                    Bookmark This Pattern
                </button>
                <div id="bookmarks-list" class="bookmarks-list">
                    <p class="empty-state">No bookmarks yet. Generate a pattern and bookmark it!</p>
                </div>
            </section>

            <!-- Practice History -->
            <section class="section">
                <details>
                    <summary>Practice History</summary>
                    <div class="practice-stats">
                    <div class="stat-item">
                        <span class="stat-value" id="total-sessions">0</span>
                        <span class="stat-label">Total Sessions</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="current-streak">0</span>
                        <span class="stat-label">Day Streak</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="total-patterns">0</span>
                        <span class="stat-label">Patterns Played</span>
                    </div>
                </div>
                <div id="practice-calendar" class="practice-calendar">
                    <!-- Calendar will be generated by JavaScript -->
                </div>
                </details>
            </section>

            <!-- Coming Soon Sections -->
            <section class="section info-section">
                <details>
                    <summary>Coming Soon</summary>
                    <ul>
                        <li>Test Mode: Real-time pitch detection and feedback</li>
                        <li>Guessing Mode: Identify intervals by ear</li>
                        <li>Interval Names: Learn interval labels</li>
                    </ul>
                </details>
            </section>
        </main>

        <!-- Guessing Mode Container (hidden by default) -->
        <div id="guessing-mode-container" style="display: none;">

            <!-- Guessing Sub-Mode Toggle -->
            <div class="guessing-toggle">
                <button id="guess-note-btn" class="guess-type-btn active" data-type="note">Guess the Note</button>
                <button id="guess-interval-btn" class="guess-type-btn" data-type="interval">Guess the Interval</button>
            </div>

            <!-- Guess Note Mode -->
            <div id="guess-note-mode" class="guess-mode-section">
                <section class="section">
                    <h2>Note Guessing</h2>
                    <p class="info-text">Listen to a single note and identify which scale degree it is (1-7)</p>

                    <button id="play-mystery-note" class="btn btn-primary" style="display: block; margin: 24px auto;">Play Mystery Note</button>

                    <div class="guess-options">
                        <div class="note-buttons">
                            <button class="note-guess-btn" data-note="1">
                                <img src="assets/digit-1.png" alt="1" class="note-digit">
                            </button>
                            <button class="note-guess-btn" data-note="2">
                                <img src="assets/digit-2.png" alt="2" class="note-digit">
                            </button>
                            <button class="note-guess-btn" data-note="3">
                                <img src="assets/digit-3.png" alt="3" class="note-digit">
                            </button>
                            <button class="note-guess-btn" data-note="4">
                                <img src="assets/digit-4.png" alt="4" class="note-digit">
                            </button>
                            <button class="note-guess-btn" data-note="5">
                                <img src="assets/digit-5.png" alt="5" class="note-digit">
                            </button>
                            <button class="note-guess-btn" data-note="6">
                                <img src="assets/digit-6.png" alt="6" class="note-digit">
                            </button>
                            <button class="note-guess-btn" data-note="7">
                                <img src="assets/digit-7.png" alt="7" class="note-digit">
                            </button>
                        </div>
                    </div>

                    <div id="note-feedback" class="guess-feedback"></div>

                    <div class="guess-actions">
                        <button id="reveal-note-btn" class="btn">Reveal Answer</button>
                    </div>
                </section>
            </div>

            <!-- Guess Interval Mode -->
            <div id="guess-interval-mode" class="guess-mode-section" style="display: none;">
                <section class="section">
                    <h2>Interval Guessing</h2>
                    <p class="info-text">Listen to two notes and identify the interval between them</p>

                    <div class="guess-play-area">
                        <button id="play-mystery-interval" class="btn btn-primary">Play Mystery Interval</button>
                        <div class="guess-progress">
                            <span id="interval-question-number">Question 1/10</span>
                            <span id="interval-correct-count">Correct: 0</span>
                        </div>
                    </div>

                    <div class="guess-options">
                        <div class="interval-buttons">
                            <button class="interval-guess-btn" data-interval="0">Unison</button>
                            <button class="interval-guess-btn" data-interval="1">Minor 2nd</button>
                            <button class="interval-guess-btn" data-interval="2">Major 2nd</button>
                            <button class="interval-guess-btn" data-interval="3">Minor 3rd</button>
                            <button class="interval-guess-btn" data-interval="4">Major 3rd</button>
                            <button class="interval-guess-btn" data-interval="5">Perfect 4th</button>
                            <button class="interval-guess-btn" data-interval="6">Tritone</button>
                            <button class="interval-guess-btn" data-interval="7">Perfect 5th</button>
                            <button class="interval-guess-btn" data-interval="8">Minor 6th</button>
                            <button class="interval-guess-btn" data-interval="9">Major 6th</button>
                            <button class="interval-guess-btn" data-interval="10">Minor 7th</button>
                            <button class="interval-guess-btn" data-interval="11">Major 7th</button>
                            <button class="interval-guess-btn" data-interval="12">Octave</button>
                        </div>
                    </div>

                    <div id="interval-feedback" class="guess-feedback"></div>

                    <div class="guess-actions">
                        <button id="reveal-interval-btn" class="btn">Reveal Answer</button>
                        <button id="next-interval-btn" class="btn" style="display: none;">Next Question</button>
                        <button id="restart-interval-btn" class="btn" style="display: none;">Start Over</button>
                    </div>
                </section>

                <!-- Settings -->
                <section class="section">
                    <details>
                        <summary>Settings</summary>
                        <div class="setting-row">
                            <label for="interval-difficulty">Difficulty:</label>
                            <select id="interval-difficulty">
                                <option value="easy">Easy (2nds, 3rds, 4ths, 5ths)</option>
                                <option value="medium" selected>Medium (+ 6ths, 7ths)</option>
                                <option value="hard">Hard (All intervals)</option>
                            </select>
                        </div>
                    </details>
                </section>
            </div>

        </div>
    </div>

    <script src="scales.js?v=1767163022"></script>
    <script src="audio-engine.js?v=1767163022"></script>
    <script src="app.js?v=1767163022"></script>
</body>
</html>
